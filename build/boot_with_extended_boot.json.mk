# This file is auto-generated by signcombinemkgen 
COMBINE_SIGN_GENERATOR=signcombinemkgen 
COMBINE_SIGN_MK_VERSION=1

ifneq ($(CY_TOOL_edgeprotecttools_EXE_ABS),)
../build/project_hex/proj_cm33_s_signed.hex : ../build/project_hex/proj_cm33_s.hex
../build/project_hex/proj_cm33_ns_shifted.hex : ../build/project_hex/proj_cm33_ns.hex
../build/app_combined.hex : ../build/project_hex/proj_cm33_s_signed.hex ../build/project_hex/proj_cm33_ns_shifted.hex ../build/project_hex/proj_cm55.hex

sign_combine_check_inputs:
ifeq (,$(MTB_SIGN_COMBINE__SKIP_CHECK))
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm33_ns.hex ]; then echo "Error: combiner signer input file '../build/project_hex/proj_cm33_ns.hex' not found. Ensure that the full application has been built at least once."; exit 1; fi
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm33_s.hex ]; then echo "Error: combiner signer input file '../build/project_hex/proj_cm33_s.hex' not found. Ensure that the full application has been built at least once."; exit 1; fi
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm55.hex ]; then echo "Error: combiner signer input file '../build/project_hex/proj_cm55.hex' not found. Ensure that the full application has been built at least once."; exit 1; fi
else
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm33_ns.hex ]; then echo "Note: combiner signer input file '../build/project_hex/proj_cm33_ns.hex' not found. Signing and combining only occurs if entire application has been built at least once.."; fi
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm33_s.hex ]; then echo "Note: combiner signer input file '../build/project_hex/proj_cm33_s.hex' not found. Signing and combining only occurs if entire application has been built at least once.."; fi
	$(MTB__NOISE)if [ ! -f ../build/project_hex/proj_cm55.hex ]; then echo "Note: combiner signer input file '../build/project_hex/proj_cm55.hex' not found. Signing and combining only occurs if entire application has been built at least once.."; fi

../build/project_hex/proj_cm33_ns.hex ../build/project_hex/proj_cm33_s.hex ../build/project_hex/proj_cm55.hex:
endif

../build/sign_combine_dependency.json: sign_combine_check_inputs FORCE
	$(MTB__NOISE)if ! cmp -s "../configs/boot_with_extended_boot.json" "$@"; then cp -f "../configs/boot_with_extended_boot.json" "$@"; fi

# Add dependency on the cycfg.timestamp file in case a personality update a symbol information file.
mtb_signcombine_rwildcard=$(strip $(foreach d,$(wildcard $1*),$(call mtb_signcombine_rwildcard,$d/,$2) $(filter $2,$d)))
# Create a dummy file to force it as out-of-date.
../build/app_combined.hex ../build/project_hex/proj_cm33_ns_shifted.hex ../build/project_hex/proj_cm33_s_signed.hex : ../build/sign_combine_dependency.json $(call mtb_signcombine_rwildcard,$(SEARCH_TARGET_$(TARGET)),%/cycfg.timestamp) | sign_combine_check_inputs
	$(MTB__NOISE)echo "" > $@

../build/.sign_combine_dependency : ../build/app_combined.hex
	mkdir -p ../build ../build/project_hex
ifeq (,$(MTB_SIGN_COMBINE__SKIP_CHECK))
	(cd ../configs && $(CY_TOOL_edgeprotecttools_EXE_ABS) run-config -i boot_with_extended_boot.json --symbol-search ../proj_cm33_s/$(SEARCH_TARGET_$(TARGET)))
else
	if [ -f ../build/project_hex/proj_cm33_ns.hex ] && [ -f ../build/project_hex/proj_cm33_s.hex ] && [ -f ../build/project_hex/proj_cm55.hex ]; then (cd ../configs && $(CY_TOOL_edgeprotecttools_EXE_ABS) run-config -i boot_with_extended_boot.json --symbol-search ../proj_cm33_s/$(SEARCH_TARGET_$(TARGET))); fi
endif
	$(MTB__NOISE)echo "" > $@

sign_combine : ../build/.sign_combine_dependency

else
sign_combine:
	$(MTB__NOISE)echo
	$(MTB__NOISE)echo "Error: EdgeProtect Secure Suite not found. Combine-Sign step not executed."
	$(MTB__NOISE)echo "Run the ModusToolbox Setup program to install the Edge Protect Security suite."
	$(MTB__NOISE)echo
	$(MTB__NOISE)exit 1
endif

.PHONY: sign_combine sign_combine_check_inputs

MTB_COMBINE_SIGN_0_PRJ_NAME=proj_cm33_s
MTB_COMBINE_SIGN_0_CONFIG_NAME=proj_cm33_s
MTB_COMBINE_SIGN_0_BUILD_DEPENDENCY=project
MTB_COMBINE_SIGN_0_HEX_PATH=../build/project_hex/proj_cm33_s_signed.hex
MTB_COMBINE_SIGN_0_EXTRA_ELF_PATH=

MTB_COMBINE_SIGN_1_PRJ_NAME=proj_cm33_ns
MTB_COMBINE_SIGN_1_CONFIG_NAME=proj_cm33_ns
MTB_COMBINE_SIGN_1_BUILD_DEPENDENCY=project
MTB_COMBINE_SIGN_1_HEX_PATH=../build/project_hex/proj_cm33_ns_shifted.hex
MTB_COMBINE_SIGN_1_EXTRA_ELF_PATH=

MTB_COMBINE_SIGN_proj_cm33_ns_HEX_FILES=1
MTB_COMBINE_SIGN_proj_cm33_s_HEX_FILES=0
